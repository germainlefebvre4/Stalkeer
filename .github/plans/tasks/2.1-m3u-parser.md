# Task 2.1: M3U Parser Implementation

**Phase**: 2 (Core Functionality)  
**Complexity**: Medium  
**Status**: Not Started

## Description

Build efficient streaming M3U parser capable of processing large playlist files without loading entire content into memory.

## Details

- Create parser package at `/internal/parser/m3u.go`
- Implement M3U format parsing:
  - Parse M3U header validation
  - Extract `#EXTINF` metadata: tvg-name, group-title, tvg-logo, duration
  - Parse stream URL from next line after EXTINF
  - Handle UTF-8 encoding properly

- Implement streaming line-by-line reader:
  - Use `bufio.Scanner` for memory-efficient processing
  - Process files incrementally without full load
  - Support large files (100k+ entries)

- Duplicate detection:
  - Calculate hash of title+URL combination
  - Skip duplicate entries, log warnings
  - Track hash collisions

- Error handling:
  - Log malformed entries without stopping parsing
  - Count parse errors per category
  - Continue processing on non-fatal errors

- Progress tracking:
  - Log processing progress at intervals (every 1000 entries)
  - Track total entries parsed
  - Measure parse duration

- Create test data:
  - Sample M3U files (100, 1000, 10000 entries)
  - Edge cases: malformed EXTINF, missing URLs, UTF-8 variations
  - Large file tests

## Dependencies

- Task 1.1 (Project structure)
- Task 1.3 (Database schema)
- Task 1.4 (Unit test foundation)

## Acceptance Criteria

- [ ] Parser correctly extracts metadata from valid EXTINF entries
- [ ] Duplicate entries detected and skipped
- [ ] Malformed entries logged without stopping parser
- [ ] Streaming parser handles 100k+ entries efficiently
- [ ] Memory usage remains constant regardless of file size
- [ ] All unit tests pass
- [ ] Parser processes 10k entries in <10 seconds
