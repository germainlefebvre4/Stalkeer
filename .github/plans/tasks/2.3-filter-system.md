# Task 2.3: Filter System

**Phase**: 2 (Core Functionality)  
**Complexity**: Medium  
**Status**: Not Started

## Description

Implement file-based and runtime filter system with persistence across application restarts.

## Details

- Create filter package at `/internal/filter/`
- Implement file-based filter loading:
  - Parse filters from `config.yml` on startup
  - Support include/exclude pattern arrays for `group-title` and `tvg-name`
  - Regex pattern compilation with error handling

- Implement runtime filter management:
  - Load existing runtime filters from database on startup
  - Store new filters in PostgreSQL `filter_configs` table
  - Persist changes across application restarts

- Filter matching logic:
  - Support regex patterns for flexible matching
  - Include patterns: item must match at least one
  - Exclude patterns: item must not match any
  - Runtime filters override file-based filters (precedence)
  - Return boolean match result

- REST API endpoints:
  - `PUT /api/v1/filters` - Create new filter
  - `PATCH /api/v1/filters/:id` - Update existing filter
  - `GET /api/v1/filters` - List all active filters
  - `DELETE /api/v1/filters/:id` - Remove filter
  - `DELETE /api/v1/filters/runtime` - Clear all runtime filters

- Filter validation:
  - Validate regex patterns before storing
  - Check for duplicate filter names
  - Return helpful error messages

- Unit tests:
  - Filter matching logic (include/exclude combinations)
  - Regex pattern compilation errors
  - Runtime vs. file-based precedence
  - Database persistence

## Dependencies

- Task 1.3 (Database schema)
- Task 1.4 (Unit test foundation)
- Task 2.4 (REST API scaffolding)

## Acceptance Criteria

- [ ] File-based filters load correctly on startup
- [ ] Runtime filters persist across application restarts
- [ ] Include/exclude logic working correctly
- [ ] Regex pattern validation prevents invalid filters
- [ ] Runtime filters properly override file-based filters
- [ ] All CRUD API endpoints functional
- [ ] Unit tests verify filter matching accuracy
- [ ] Filters applied correctly to query results
