# Task 2.6: CLI Structure (Cobra)

**Phase**: 2 (Core Functionality)  
**Complexity**: Medium  
**Status**: Completed

## Description

Build comprehensive command hierarchy using Cobra framework for operational tasks and administration.

## Details

- Create CLI package at `/internal/cli/` or `/cmd/`
- Implement command hierarchy:

  **Root command:**
  - `stalkeer` - Application entry point
  - Global flags: `--config`, `--log-level`, `--db-url`
  - Subcommands: process, server, dryrun, config, migrate

  **Subcommands:**
  - `stalkeer process` - Load M3U and store to database
    - Flags: `--file` (M3U path), `--force` (re-process), `--limit` (max items)
    - Output: processing summary and statistics
  
  - `stalkeer server` - Start REST API server
    - Flags: `--port` (default: 8080), `--address` (default: 0.0.0.0)
    - Output: startup messages, health status
  
  - `stalkeer dryrun` - Execute dry-run analysis
    - Flags: `--file` (M3U path), `--limit` (max items to analyze)
    - Output: structured analysis report
  
  - `stalkeer config` - Validate and display current configuration
    - Flags: `--show-secrets` (reveal password fields)
    - Output: formatted config display
  
  - `stalkeer migrate` - Database schema setup/migration
    - Flags: `--up` (apply migrations), `--down` (rollback)
    - Output: migration status

  - `stalkeer version` - Display application version
    - Output: version number and build info

- Flag implementation:
  - Global flags available to all commands
  - Command-specific flags
  - Flag validation and type checking
  - Short/long flag variants where appropriate

- Help and documentation:
  - Clear help text for all commands
  - Usage examples for common workflows
  - Comprehensive --help output
  - Man page generation support

- Error handling:
  - Clear error messages on command failure
  - Exit codes: 0 (success), 1 (error), 2 (usage error)
  - Helpful suggestions for common mistakes

- Unit tests:
  - Test command parsing
  - Test flag handling
  - Test help text generation
  - Test error cases

## Dependencies

- Task 2.1 (M3U Parser)
- Task 2.4 (REST API)
- Task 2.5 (Dry-Run Mode)

## Acceptance Criteria

- [x] All commands parse and execute correctly
- [x] Global flags properly propagate to subcommands
- [x] Help text comprehensive and accurate
- [x] Command examples documented and tested
- [x] Exit codes appropriate for success/failure
- [ ] Unit tests verify command parsing
- [ ] Flags and options thoroughly tested

## Completion Notes

- Complete Cobra CLI structure in `/cmd/main.go`
- Root command with global `--config` flag
- All 7 subcommands implemented:
  - `version`: Displays version number
  - `parse`: Parse M3U file with statistics and verbose output
  - `server`: Start REST API server with configurable port and address
  - `process`: Process M3U and store to database (placeholder for future implementation)
  - `dryrun`: Execute dry-run analysis with configurable limit
  - `config`: Display configuration with --show-secrets flag
  - `migrate`: Run database migrations
- Command-specific flags:
  - `parse`: `-v, --verbose`
  - `server`: `-p, --port`, `-a, --address`
  - `process`: `--force`, `--limit`
  - `dryrun`: `--limit`
  - `config`: `--show-secrets`
- Configuration initialization with cobra.OnInitialize
- Proper error handling and exit codes throughout
- Comprehensive help text for all commands
- File path support via CLI arguments or config file

**Future Enhancements:**
- Add unit tests for command parsing logic
- Complete `process` command implementation with full processing pipeline
- Add progress bars for long-running operations
- Add interactive mode for configuration setup
