# Task 3.7: Docker & Deployment Preparation

**Phase**: 3 (Polish, Integration & Deploy)  
**Complexity**: Medium  
**Status**: Not Started

## Description

Containerize the application and prepare for production deployment with Docker and docker-compose.

## Details

- Dockerfile creation:
  - Multi-stage build (builder + runtime)
  - Builder stage: compile Go binary
  - Runtime stage: minimal Alpine Linux base
  - COPY only necessary artifacts
  - Non-root user for security
  - Proper layer caching optimization

- .dockerignore file:
  - Exclude development files
  - Exclude git history
  - Exclude test files
  - Exclude build artifacts

- docker-compose.yml updates:
  - Stalkeer service definition
  - PostgreSQL service with volumes
  - Network configuration
  - Environment variable setup
  - Port mappings (API: 8080, admin: 8081)
  - Health check configuration

- Health check implementation:
  - `/health` endpoint for container health checks
  - Database connectivity test
  - Response: 200 OK with status JSON
  - Timeout: 5 seconds

- Environment-based configuration:
  - Development environment config
  - Staging environment config
  - Production environment config
  - Config overrides via environment variables

- Database initialization:
  - Init script for schema creation
  - Data seeding (optional demo data)
  - Migration running on startup
  - Connection retry logic

- Logging setup:
  - Log output to stdout/stderr (Docker best practices)
  - Structured JSON logging
  - Log level configuration via environment
  - No file-based logging in containers

- Volume management:
  - Named volume for PostgreSQL data persistence
  - Optional volume for M3U files
  - Configuration file mounting

- Networking:
  - Container-to-container communication
  - External port exposure configuration
  - DNS resolution between services

- Security considerations:
  - Non-root user in container
  - Read-only root filesystem option
  - Security scanning for vulnerabilities
  - Secrets management (environment variables)

- Performance tuning:
  - Resource limits (memory, CPU)
  - Buffer size optimization
  - Network timeout tuning

## Dependencies

- All Phase 2 and 3 tasks (for deployable application)

## Acceptance Criteria

- [ ] Dockerfile builds successfully
- [ ] Multi-stage build reduces image size
- [ ] Docker image runs without errors
- [ ] docker-compose up starts all services
- [ ] Health check endpoint functional
- [ ] Database initializes on first run
- [ ] Application accessible at configured ports
- [ ] Logs properly output to stdout/stderr
- [ ] Environment variables override config correctly
